({607:function(){var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function i(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}c((r=r.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},n=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var s=arguments[t],o=0,i=s.length;o<i;o++,a++)r[a]=s[o];return r},r=function(){function r(){}return r.processQueue=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.debug("Processing Queue ->",e),"string"==typeof e[0]&&r[e[0]].apply(r,e.slice(1))},r.processOldQueue=function(e){var t=this;e.forEach((function(e){t.processQueue.apply(t,e)}))},r.setCallback=function(e,t){this[e]=t},r.init=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this.debug("SDK Initialization");var n=["score","highScore",e,t];if(!this.isLoaded){window.parent.postMessage({controller:"_digitapGame",type:"SDK_SETTINGS",ui:n,ready:!0},"*"),this.listenGameboxEvents(),this.listenStreamrEvents();var r=document.getElementsByTagName("canvas"),a=document.getElementsByTagName("html");setTimeout((function(){var e=r[0].getAttribute("style");r[0].setAttribute("style",e+"width: 100%; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; -moz-user-select: none;");var t=a[0].getAttribute("style");a[0].setAttribute("style",(t||"")+"user-select: none; -webkit-user-select: none; -moz-user-select: none;")}),2e3)}this.isLoaded=!0},r.setProgress=function(e,t,n){this.progress={type:"SDK_PLAYER_SCORE_UPDATE",state:e,score:t,level:n,continueScore:t,controller:"_digitapGame"},this.sendData()},r.setLevelUp=function(e){this.progress.level=e,this.progress.type="SDK_PLAYER_LEVEL_UP",this.sendData()},r.setPlayerFailed=function(e){void 0===e&&(e="FAIL"),this.progress.state=e,this.progress.score=0,this.progress.type="SDK_PLAYER_FAILED",this.sendData()},r.sendData=function(){window.parent.postMessage(this.progress,this.origin)},r.listenGameboxEvents=function(){var e=this;window.addEventListener("message",(function(t){if(r.debug("Event Received -> %o -> %o",t.data,t.origin),"object"==typeof t.data&&t.data.controller&&"_digitapApp"==t.data.controller){var n=e.allowedOrigins.indexOf(t.origin);if(-1===n)return void r.debug("Error: Origin not allowed inside game container!");if(e.origin=e.allowedOrigins[n],t.data.type)switch(t.data.type){case"SDK_START_GAME":e.afterStartGame();break;case"SDK_PAUSE_GAME":e.afterPauseGame();break;case"SDK_START_GAME_FROM_ZERO":e.progress.score=0,e.progress.level=0,e.progress.continueScore=0,e.afterStartGameFromZero();break;case"SDK_CONTINUE_WITH_CURRENT_SCORE":e.progress.score=e.progress.continueScore,e.afterContinueWithCurrentScore(e.progress.score,e.progress.level);break;default:r.debug('Error: `data.type` = "'+t.data.type+'" not found! Please check `readme.md` of data collector package!')}else r.debug("Error: `event.data.type` should be implemented!")}}),!1)},r.listenStreamrEvents=function(){var n=this,a=null,s=null,o=null,i=null,c=null,l=!1,u=!1,d=this;d.debug("Init Streamr v1.0.11"),window.addEventListener("message",(function(p){return e(n,void 0,void 0,(function(){var n,g,f,h,v,m,S,_,b,E,y,w,C,D,L,T,R,A,O,k,P,G,K=this;return t(this,(function(N){switch(N.label){case 0:if(N.trys.push([0,5,,6]),r.debug("Streamr Event received",p.data),!p.data||"object"!=typeof p.data)return[2];if(n=p.data,g=n.controller,f=n.type,h=n.action,v=n.offer,m=n.tournament_id,S=n.username,r.debug("Streamr Event details: ",g,f,h,v,m,S),"_digitapApp"!==g||"webrtc"!==f)return[2];if(r.debug("Streamr –> Passed validation"),l||(a=document.querySelector("canvas"),s=a.captureStream(30),o=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),i=o.createDataChannel("streamr-"+m+"-"+S,{negotiated:!0,id:0})),"close"===h){for(_=0,b=o.getSenders();_<b.length;_++)E=b[_],o.removeTrack(E);return a=null,s=null,i.send(JSON.stringify({type:"streamr",action:"close"})),o.close(),o=null,i=null,c=null,l=!1,u=!1,[2]}if("init"!==h)return[3,4];for(y=0,w=s.getTracks();y<w.length;y++)C=w[y],o.addTrack(C,s);return D=function(e){switch(d.debug("Streamr –> __WEBRTC.onConnectionStateChange__",o.connectionState),o.connectionState){case"connected":l=!0,p.source.postMessage({type:"streamr",action:"connected"},p.origin);break;case"disconnected":for(var t=0,n=o.getSenders();t<n.length;t++){var r=n[t];o.removeTrack(r)}a=null,s=null,p.source.postMessage({type:"streamr",action:"disconnected"},p.origin),i.close(),o.close(),o.removeEventListener("connectionstatechange",D),o.removeEventListener("iceconnectionstatechange",L),o.removeEventListener("icecandidate",T),o.removeEventListener("onnegotiationneeded",A),o.removeEventListener("onsignalingstatechange",O),i.removeEventListener("message",R),o=null,i=null,c=null,l=!1}},L=function(e){switch(d.debug("Streamr –> __WEBRTC.onICEConnectionStateChange__",o.iceConnectionState),o.iceConnectionState){case"connected":break;case"disconnected":case"failed":o.restartIce()}},T=function(e){try{d.debug("Streamr –> __WEBRTC.onICECandidate__",e.candidate),e.candidate?c=e.candidate:(d.debug("Streamr –> __WEBRTC.localDescription__",o.localDescription),p.source.postMessage({type:"streamr",action:"answer",offer:window.btoa(JSON.stringify(o.localDescription))},p.origin))}catch(e){console.error("Streamr –> __WEBRTC.onICECandidate__",e.message)}},R=function(n){return e(K,void 0,void 0,(function(){var e,r;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),n.data?(e=JSON.parse(n.data)).iceCandidate?[4,o.addIceCandidate(e.iceCandidate)]:[3,2]:[2];case 1:t.sent(),i.send(JSON.stringify({iceCandidate:c})),t.label=2;case 2:return[3,4];case 3:return r=t.sent(),console.error("Streamr –> __WEBRTC.onMessage__",r.message),[3,4];case 4:return[2]}}))}))},A=function(n){return e(K,void 0,void 0,(function(){var e,n,r;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),u?[2]:[4,o.setRemoteDescription(JSON.parse(v))];case 1:return t.sent(),n=(e=o).setLocalDescription,[4,o.createAnswer()];case 2:return[4,n.apply(e,[t.sent()])];case 3:return t.sent(),[3,5];case 4:return r=t.sent(),console.error("Streamr –> __WEBRTC.onNegotiationNeeded",r.message),[3,5];case 5:return[2]}}))}))},O=function(e){return u="stable"!==o.signalingState},o.addEventListener("connectionstatechange",D),o.addEventListener("iceconnectionstatechange",L),o.addEventListener("icecandidate",T),o.addEventListener("onnegotiationneeded",A),o.addEventListener("onsignalingstatechange",O),i.addEventListener("message",R),[4,o.setRemoteDescription(JSON.parse(v))];case 1:return N.sent(),P=(k=o).setLocalDescription,[4,o.createAnswer()];case 2:return[4,P.apply(k,[N.sent()])];case 3:N.sent(),N.label=4;case 4:return[3,6];case 5:return G=N.sent(),d.debug("Streamr -> __WEBRTC__",G.message),[3,6];case 6:return[2]}}))}))}))},r.afterStartGameFromZero=function(){},r.afterContinueWithCurrentScore=function(e,t){},r.afterStartGame=function(){},r.afterPauseGame=function(){},r.debug=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];window,console.log.apply(console,n(["DigitapGamePlayerSDK -> "+e],t))},r.gameObject=null,r.isLoaded=!1,r.origin=null,r.isDebugging=!1,r.allowedOrigins=["https://build.digitap.dev","https://wam.app","https://app.wam.app","https://wam.eu","https://play.wam.app","https://stage.wam.app","http://localhost:63342","http://localhost:8080","http://localhost:3000","http://localhost:3001","https://localhost:3001","http://127.0.0.1:3001","https://127.0.0.1:3001"],r.progress={controller:"_digitapGame",type:"SDK_PLAYER_SCORE_UPDATE",score:0,level:0,state:null,continueScore:0},r}();if(void 0!==window.digitapSDK){var a=window.digitapSDK.q;r.processOldQueue(a)}window.digitapSDK=r.processQueue}})[607]();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nYW1lLXBsYXllci1zZGsvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vZ2FtZS1wbGF5ZXItc2RrL3dlYnBhY2svc3RhcnR1cCJdLCJuYW1lcyI6WyJwcm9jZXNzUXVldWUiLCJEaWdpdGFwR2FtZVBsYXllclNESyIsImRlYnVnIiwiYXJncyIsImFwcGx5Iiwic2xpY2UiLCJwcm9jZXNzT2xkUXVldWUiLCJxdWV1ZSIsImZvckVhY2giLCJzZXRDYWxsYmFjayIsImZuIiwiY2FsbGJhY2siLCJ0aGlzIiwiaW5pdCIsImhhc1Njb3JlIiwiaGFzSGlnaFNjb3JlIiwidWlPcHRpb25zIiwiaXNMb2FkZWQiLCJ3aW5kb3ciLCJwYXJlbnQiLCJwb3N0TWVzc2FnZSIsImNvbnRyb2xsZXIiLCJ0eXBlIiwidWkiLCJyZWFkeSIsImxpc3RlbkdhbWVib3hFdmVudHMiLCJsaXN0ZW5TdHJlYW1yRXZlbnRzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInNldFRpbWVvdXQiLCJjYW52YXNTdHlsZSIsImdldEF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsImh0bWxTdHlsZSIsInNldFByb2dyZXNzIiwic3RhdGUiLCJzY29yZSIsImxldmVsIiwicHJvZ3Jlc3MiLCJjb250aW51ZVNjb3JlIiwic2VuZERhdGEiLCJzZXRMZXZlbFVwIiwic2V0UGxheWVyRmFpbGVkIiwib3JpZ2luIiwic2VsZiIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImRhdGEiLCJvcmlnaW5JbmRleCIsImFsbG93ZWRPcmlnaW5zIiwiaW5kZXhPZiIsImFmdGVyU3RhcnRHYW1lIiwiYWZ0ZXJQYXVzZUdhbWUiLCJhZnRlclN0YXJ0R2FtZUZyb21aZXJvIiwiYWZ0ZXJDb250aW51ZVdpdGhDdXJyZW50U2NvcmUiLCJjYW52YXMiLCJzdHJlYW0iLCJjb25uZWN0aW9uIiwiY2hhbm5lbCIsImljZUNhbmRpZGF0ZSIsImNvbm5lY3RlZCIsImlzTmVnb3RpYXRpb25OZWVkZWQiLCJhY3Rpb24iLCJvZmZlciIsInRvdXJuYW1lbnRfaWQiLCJ1c2VybmFtZSIsInF1ZXJ5U2VsZWN0b3IiLCJjYXB0dXJlU3RyZWFtIiwiUlRDUGVlckNvbm5lY3Rpb24iLCJpY2VTZXJ2ZXJzIiwidXJscyIsImNyZWF0ZURhdGFDaGFubmVsIiwibmVnb3RpYXRlZCIsImlkIiwiZ2V0U2VuZGVycyIsInNlbmRlciIsInJlbW92ZVRyYWNrIiwic2VuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjbG9zZSIsImdldFRyYWNrcyIsInRyYWNrIiwiYWRkVHJhY2siLCJlIiwiY29ubmVjdGlvblN0YXRlIiwic291cmNlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImljZUNvbm5lY3Rpb25TdGF0ZSIsInJlc3RhcnRJY2UiLCJjYW5kaWRhdGUiLCJsb2NhbERlc2NyaXB0aW9uIiwiYnRvYSIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsIm1lc3NhZ2UiLCJwYXJzZSIsImFkZEljZUNhbmRpZGF0ZSIsInNldFJlbW90ZURlc2NyaXB0aW9uIiwic2V0TG9jYWxEZXNjcmlwdGlvbiIsImNyZWF0ZUFuc3dlciIsInNpZ25hbGluZ1N0YXRlIiwibG9nIiwicGFyYW1zIiwiZ2FtZU9iamVjdCIsImlzRGVidWdnaW5nIiwiZGlnaXRhcFNESyIsIm9sZFF1ZXVlIiwicSJdLCJtYXBwaW5ncyI6Im1tREFhQSwyQkFvaEJBLE9BL2VnQixFQUFBQSxhQUFkLFcsSUFBMkIsc0RBQ3pCQyxFQUFxQkMsTUFBTSxzQkFBdUJDLEdBRTNCLGlCQUFaQSxFQUFLLElBQ2RGLEVBQ0VFLEVBQUssSUFNTEMsTUFBTUgsRUFBc0JFLEVBQUtFLE1BQU0sS0FTL0IsRUFBQUMsZ0JBQWQsU0FBOEJDLEdBQTlCLFdBQ0VBLEVBQU1DLFNBQVEsU0FBQ0wsR0FDYixFQUFLSCxhQUFZLE1BQWpCLEVBQXFCRyxPQVVYLEVBQUFNLFlBQWQsU0FDRUMsRUFLQUMsR0FFQUMsS0FBS0YsR0FBTUMsR0FTQyxFQUFBRSxLQUFkLFNBQ0VDLEVBQ0FD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M0MsRUFBQUMsV0FBa0IsS0FDakIsRUFBQXhGLFVBQW9CLEVBQ3BCLEVBQUEwQixPQUFpQixLQUNqQixFQUFBK0QsYUFBdUIsRUFFdkIsRUFBQXpELGVBQTJCLENBQ3hDLDRCQUNBLGtCQUNBLHNCQUNBLGlCQUNBLHVCQUNBLHdCQUNBLHlCQUNBLHdCQUNBLHdCQUNBLHdCQUNBLHlCQUNBLHdCQUNBLDBCQUdhLEVBQUFYLFNBQXFCLENBQ2xDakIsV0FBWSxlQUNaQyxLQUFNLDBCQUNOYyxNQUFPLEVBQ1BDLE1BQU8sRUFDUEYsTUFBTyxLQUNQSSxjQUFlLEdBd2ZuQixFQXBoQkEsR0F1aEJBLFFBQXdDLElBQXZCckIsT0FBUXlGLFdBQTRCLENBQ25ELElBQUlDLEVBQWlCMUYsT0FBUXlGLFdBQVdFLEVBQ3hDNUcsRUFBcUJLLGdCQUFnQnNHLEdBSWpDMUYsT0FBUXlGLFdBQWExRyxFQUFxQkQsZ0JDdmlCNUIiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIFByb2dyZXNzID0ge1xuICBjb250cm9sbGVyOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbiAgc2NvcmU6IG51bWJlcjtcbiAgbGV2ZWw6IG51bWJlcjtcbiAgc3RhdGU6IGFueTtcbiAgY29udGludWVTY29yZTogbnVtYmVyO1xufTtcblxuaW50ZXJmYWNlIENhbnZhc0VsZW1lbnQgZXh0ZW5kcyBIVE1MQ2FudmFzRWxlbWVudCB7XG4gIGNhcHR1cmVTdHJlYW0oZnJhbWVSYXRlPzogbnVtYmVyKTogTWVkaWFTdHJlYW07XG59XG5cbmNsYXNzIERpZ2l0YXBHYW1lUGxheWVyU0RLIHtcbiAgcHVibGljIHN0YXRpYyBnYW1lT2JqZWN0OiBhbnkgPSBudWxsO1xuICBwcml2YXRlIHN0YXRpYyBpc0xvYWRlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHN0YXRpYyBvcmlnaW46IHN0cmluZyA9IG51bGw7XG4gIHByaXZhdGUgc3RhdGljIGlzRGVidWdnaW5nOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBzdGF0aWMgYWxsb3dlZE9yaWdpbnM6IHN0cmluZ1tdID0gW1xuICAgIFwiaHR0cHM6Ly9idWlsZC5kaWdpdGFwLmRldlwiLFxuICAgIFwiaHR0cHM6Ly93YW0uYXBwXCIsXG4gICAgXCJodHRwczovL2FwcC53YW0uYXBwXCIsXG4gICAgXCJodHRwczovL3dhbS5ldVwiLFxuICAgIFwiaHR0cHM6Ly9wbGF5LndhbS5hcHBcIixcbiAgICBcImh0dHBzOi8vc3RhZ2Uud2FtLmFwcFwiLFxuICAgIFwiaHR0cDovL2xvY2FsaG9zdDo2MzM0MlwiLFxuICAgIFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwXCIsXG4gICAgXCJodHRwOi8vbG9jYWxob3N0OjMwMDBcIixcbiAgICBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMVwiLFxuICAgIFwiaHR0cHM6Ly9sb2NhbGhvc3Q6MzAwMVwiLFxuICAgIFwiaHR0cDovLzEyNy4wLjAuMTozMDAxXCIsXG4gICAgXCJodHRwczovLzEyNy4wLjAuMTozMDAxXCIsXG4gIF07XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcHJvZ3Jlc3M6IFByb2dyZXNzID0ge1xuICAgIGNvbnRyb2xsZXI6IFwiX2RpZ2l0YXBHYW1lXCIsXG4gICAgdHlwZTogXCJTREtfUExBWUVSX1NDT1JFX1VQREFURVwiLFxuICAgIHNjb3JlOiAwLFxuICAgIGxldmVsOiAwLFxuICAgIHN0YXRlOiBudWxsLFxuICAgIGNvbnRpbnVlU2NvcmU6IDAsXG4gIH07XG5cbiAgLyoqXG4gICAqIENhbGwgYSBtZXRob2QgZnJvbSB0aGUgY2xhc3MsXG4gICAqIHRocm91Z2ggYSBxdWV1ZS5cbiAgICpcbiAgICogQHBhcmFtIGFyZ3MgYXJyYXlcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcHJvY2Vzc1F1ZXVlKC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XG4gICAgRGlnaXRhcEdhbWVQbGF5ZXJTREsuZGVidWcoXCJQcm9jZXNzaW5nIFF1ZXVlIC0+XCIsIGFyZ3MpO1xuXG4gICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBEaWdpdGFwR2FtZVBsYXllclNES1tcbiAgICAgICAgYXJnc1swXSBhc1xuICAgICAgICAgIHwgXCJpbml0XCJcbiAgICAgICAgICB8IFwic2V0UHJvZ3Jlc3NcIlxuICAgICAgICAgIHwgXCJzZXRMZXZlbFVwXCJcbiAgICAgICAgICB8IFwic2V0UGxheWVyRmFpbGVkXCJcbiAgICAgICAgICB8IFwic2V0Q2FsbGJhY2tcIlxuICAgICAgXS5hcHBseShEaWdpdGFwR2FtZVBsYXllclNESywgYXJncy5zbGljZSgxKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYSBjdXJyZW50IHF1ZXVlLlxuICAgKlxuICAgKiBAcGFyYW0gcXVldWUgYXJyYXlcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcHJvY2Vzc09sZFF1ZXVlKHF1ZXVlOiBbXSk6IHZvaWQge1xuICAgIHF1ZXVlLmZvckVhY2goKGFyZ3M6IGFueSkgPT4ge1xuICAgICAgdGhpcy5wcm9jZXNzUXVldWUoLi4uYXJncyk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBhIGNhbGxiYWNrIG1ldGhvZC5cbiAgICpcbiAgICogQHBhcmFtIGZuIHN0cmluZ1xuICAgKiBAcGFyYW0gY2FsbGJhY2sgZnVuY3Rpb25cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgc2V0Q2FsbGJhY2soXG4gICAgZm46XG4gICAgICB8IFwiYWZ0ZXJTdGFydEdhbWVGcm9tWmVyb1wiXG4gICAgICB8IFwiYWZ0ZXJDb250aW51ZVdpdGhDdXJyZW50U2NvcmVcIlxuICAgICAgfCBcImFmdGVyU3RhcnRHYW1lXCJcbiAgICAgIHwgXCJhZnRlclBhdXNlR2FtZVwiLFxuICAgIGNhbGxiYWNrOiBhbnlcbiAgKTogdm9pZCB7XG4gICAgdGhpc1tmbl0gPSBjYWxsYmFjaztcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0IGEgbmV3IGdhbWUgY29ubmVjdGlvbiB3aXRoXG4gICAqIHRoZSBwYXJlbnQgcGxhdGZvcm0uXG4gICAqXG4gICAqIEBwYXJhbSB1aU9wdGlvbnMgYXJyYXlcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgaW5pdChcbiAgICBoYXNTY29yZTogYm9vbGVhbiA9IHRydWUsXG4gICAgaGFzSGlnaFNjb3JlOiBib29sZWFuID0gdHJ1ZVxuICApOiB2b2lkIHtcbiAgICB0aGlzLmRlYnVnKFwiU0RLIEluaXRpYWxpemF0aW9uXCIpO1xuXG4gICAgLy8gSW5pdCB0aGUgdWlPcHRpb25zXG4gICAgY29uc3QgdWlPcHRpb25zID0gW1wic2NvcmVcIiwgXCJoaWdoU2NvcmVcIiwgaGFzU2NvcmUsIGhhc0hpZ2hTY29yZV07XG5cbiAgICAvLyBJZiBTREsgaXMgbm90IGxvYWRlZCB5ZXRcbiAgICBpZiAoIXRoaXMuaXNMb2FkZWQpIHtcbiAgICAgIC8vIFNlbmQgdGhlIGluaXQgbWVzc2FnZVxuICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZShcbiAgICAgICAge1xuICAgICAgICAgIGNvbnRyb2xsZXI6IFwiX2RpZ2l0YXBHYW1lXCIsXG4gICAgICAgICAgdHlwZTogXCJTREtfU0VUVElOR1NcIixcbiAgICAgICAgICB1aTogdWlPcHRpb25zLFxuICAgICAgICAgIHJlYWR5OiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBcIipcIlxuICAgICAgKTtcblxuICAgICAgLy8gV2F0Y2ggZm9yIG1lc3NhZ2VzIGZyb20gR2FtZUJveFxuICAgICAgdGhpcy5saXN0ZW5HYW1lYm94RXZlbnRzKCk7XG5cbiAgICAgIC8vIFdhdGNoIGZvciBtZXNzYWdlcyBmcm9tIFN0cmVhbXJcbiAgICAgIHRoaXMubGlzdGVuU3RyZWFtckV2ZW50cygpO1xuXG4gICAgICAvLyBTZXQgdGhlIGNhbnZhcyBmdWxsd2lkdGggJiBibHVlIHNjcmVlbiBmaXhcbiAgICAgIGNvbnN0IGNhbnZhczogSFRNTENvbGxlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImNhbnZhc1wiKTtcbiAgICAgIGNvbnN0IGh0bWw6IEhUTUxDb2xsZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJodG1sXCIpO1xuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgbGV0IGNhbnZhc1N0eWxlID0gY2FudmFzWzBdLmdldEF0dHJpYnV0ZShcInN0eWxlXCIpO1xuICAgICAgICBjYW52YXNbMF0uc2V0QXR0cmlidXRlKFxuICAgICAgICAgIFwic3R5bGVcIixcbiAgICAgICAgICBjYW52YXNTdHlsZSArXG4gICAgICAgICAgICBcIndpZHRoOiAxMDAlOyBtYXJnaW46IDA7IHBhZGRpbmc6IDA7IHVzZXItc2VsZWN0OiBub25lOyAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOyAtbW96LXVzZXItc2VsZWN0OiBub25lO1wiXG4gICAgICAgICk7XG5cbiAgICAgICAgbGV0IGh0bWxTdHlsZSA9IGh0bWxbMF0uZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gICAgICAgIGh0bWxbMF0uc2V0QXR0cmlidXRlKFxuICAgICAgICAgIFwic3R5bGVcIixcbiAgICAgICAgICAoaHRtbFN0eWxlID8gaHRtbFN0eWxlIDogXCJcIikgK1xuICAgICAgICAgICAgXCJ1c2VyLXNlbGVjdDogbm9uZTsgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsgLW1vei11c2VyLXNlbGVjdDogbm9uZTtcIlxuICAgICAgICApO1xuICAgICAgfSwgMjAwMCk7XG4gICAgfVxuXG4gICAgLy8gU2V0IFNESyBhcyBsb2FkZWQgdG8gcHJldmVudCByZS1pbml0aWF0aW9uXG4gICAgdGhpcy5pc0xvYWRlZCA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHByb2dyZXNzIG9mIGEgZ2FtZS5cbiAgICpcbiAgICogQHBhcmFtIHR5cGUgc3RyaW5nXG4gICAqIEBwYXJhbSBzdGF0ZSBzdHJpbmdcbiAgICogQHBhcmFtIHNjb3JlIG51bWJlclxuICAgKiBAcGFyYW0gbGV2ZWwgbnVtYmVyXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHNldFByb2dyZXNzKHN0YXRlOiBzdHJpbmcsIHNjb3JlOiBudW1iZXIsIGxldmVsOiBudW1iZXIpOiB2b2lkIHtcbiAgICAvLyBTZXQgdGhlIGN1cnJlbnQgcHJvZ3Jlc3NcbiAgICB0aGlzLnByb2dyZXNzID0ge1xuICAgICAgdHlwZTogXCJTREtfUExBWUVSX1NDT1JFX1VQREFURVwiLFxuICAgICAgc3RhdGUsXG4gICAgICBzY29yZSxcbiAgICAgIGxldmVsLFxuICAgICAgY29udGludWVTY29yZTogc2NvcmUsXG4gICAgICBjb250cm9sbGVyOiBcIl9kaWdpdGFwR2FtZVwiLFxuICAgIH07XG5cbiAgICB0aGlzLnNlbmREYXRhKCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBuZXcgbGV2ZWwgb2YgdGhlIGdhbWUuXG4gICAqXG4gICAqIEBwYXJhbSBsZXZlbCBudW1iZXJcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgc2V0TGV2ZWxVcChsZXZlbDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5wcm9ncmVzcy5sZXZlbCA9IGxldmVsO1xuICAgIHRoaXMucHJvZ3Jlc3MudHlwZSA9IFwiU0RLX1BMQVlFUl9MRVZFTF9VUFwiO1xuXG4gICAgdGhpcy5zZW5kRGF0YSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgZ2FtZSBhcyBmYWlsZWQuXG4gICAqXG4gICAqIEBwYXJhbSBzdGF0ZSBzdHJpbmdcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgc2V0UGxheWVyRmFpbGVkKHN0YXRlOiBzdHJpbmcgPSBcIkZBSUxcIik6IHZvaWQge1xuICAgIHRoaXMucHJvZ3Jlc3Muc3RhdGUgPSBzdGF0ZTtcbiAgICB0aGlzLnByb2dyZXNzLnNjb3JlID0gMDtcbiAgICB0aGlzLnByb2dyZXNzLnR5cGUgPSBcIlNES19QTEFZRVJfRkFJTEVEXCI7XG5cbiAgICB0aGlzLnNlbmREYXRhKCk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZHMgZ2FtZSBkYXRhIHRvIHBhcmVudCBwbGF0Zm9ybS5cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIHNlbmREYXRhKCk6IHZvaWQge1xuICAgIC8vIFNlbmQgdGhlIG1lc3NhZ2UgdG8gR2FtZWJveC5cbiAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHRoaXMucHJvZ3Jlc3MsIHRoaXMub3JpZ2luKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBsaXN0ZW5pbmcgZm9yIG1lc3NhZ2VzXG4gICAqIGZyb20gdGhlIHBsYXRmb3JtLlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgbGlzdGVuR2FtZWJveEV2ZW50cygpOiB2b2lkIHtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgXCJtZXNzYWdlXCIsXG4gICAgICBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgRGlnaXRhcEdhbWVQbGF5ZXJTREsuZGVidWcoXCJFdmVudCBSZWNlaXZlZCAtPiAlbyAtPiAlb1wiLCBldmVudC5kYXRhLCBldmVudC5vcmlnaW4pO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICB0eXBlb2YgZXZlbnQuZGF0YSA9PSBcIm9iamVjdFwiICYmXG4gICAgICAgICAgZXZlbnQuZGF0YS5jb250cm9sbGVyICYmXG4gICAgICAgICAgZXZlbnQuZGF0YS5jb250cm9sbGVyID09IFwiX2RpZ2l0YXBBcHBcIlxuICAgICAgICApIHtcbiAgICAgICAgICBsZXQgb3JpZ2luSW5kZXggPSBzZWxmLmFsbG93ZWRPcmlnaW5zLmluZGV4T2YoZXZlbnQub3JpZ2luKTtcblxuICAgICAgICAgIGlmIChvcmlnaW5JbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIERpZ2l0YXBHYW1lUGxheWVyU0RLLmRlYnVnKFwiRXJyb3I6IE9yaWdpbiBub3QgYWxsb3dlZCBpbnNpZGUgZ2FtZSBjb250YWluZXIhXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZWxmLm9yaWdpbiA9IHNlbGYuYWxsb3dlZE9yaWdpbnNbb3JpZ2luSW5kZXhdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChldmVudC5kYXRhLnR5cGUpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQuZGF0YS50eXBlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJTREtfU1RBUlRfR0FNRVwiOlxuICAgICAgICAgICAgICAgIHNlbGYuYWZ0ZXJTdGFydEdhbWUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIFwiU0RLX1BBVVNFX0dBTUVcIjpcbiAgICAgICAgICAgICAgICBzZWxmLmFmdGVyUGF1c2VHYW1lKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSBcIlNES19TVEFSVF9HQU1FX0ZST01fWkVST1wiOlxuICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3Muc2NvcmUgPSAwO1xuICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3MubGV2ZWwgPSAwO1xuICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3MuY29udGludWVTY29yZSA9IDA7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmFmdGVyU3RhcnRHYW1lRnJvbVplcm8oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIFwiU0RLX0NPTlRJTlVFX1dJVEhfQ1VSUkVOVF9TQ09SRVwiOlxuICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3Muc2NvcmUgPSBzZWxmLnByb2dyZXNzLmNvbnRpbnVlU2NvcmU7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmFmdGVyQ29udGludWVXaXRoQ3VycmVudFNjb3JlKFxuICAgICAgICAgICAgICAgICAgc2VsZi5wcm9ncmVzcy5zY29yZSxcbiAgICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3MubGV2ZWxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgRGlnaXRhcEdhbWVQbGF5ZXJTREsuZGVidWcoXG4gICAgICAgICAgICAgICAgICAnRXJyb3I6IGBkYXRhLnR5cGVgID0gXCInICtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZGF0YS50eXBlICtcbiAgICAgICAgICAgICAgICAgICAgJ1wiIG5vdCBmb3VuZCEgUGxlYXNlIGNoZWNrIGByZWFkbWUubWRgIG9mIGRhdGEgY29sbGVjdG9yIHBhY2thZ2UhJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIERpZ2l0YXBHYW1lUGxheWVyU0RLLmRlYnVnKFwiRXJyb3I6IGBldmVudC5kYXRhLnR5cGVgIHNob3VsZCBiZSBpbXBsZW1lbnRlZCFcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZmFsc2VcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IGxpc3RlbmluZyBmb3IgbWVzc2FnZXNcbiAgICogZnJvbSB0aGUgU3RyZWFtciBwbGF0Zm9ybS5cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGxpc3RlblN0cmVhbXJFdmVudHMoKTogdm9pZCB7XG4gICAgbGV0IGNhbnZhczogQ2FudmFzRWxlbWVudCA9IG51bGw7XG4gICAgbGV0IHN0cmVhbTogYW55ID0gbnVsbDtcbiAgICBsZXQgY29ubmVjdGlvbjogYW55ID0gbnVsbDtcbiAgICBsZXQgY2hhbm5lbDogYW55ID0gbnVsbDtcbiAgICBsZXQgaWNlQ2FuZGlkYXRlOiBhbnkgPSBudWxsO1xuICAgIGxldCBjb25uZWN0ZWQgPSBmYWxzZTtcbiAgICBsZXQgaXNOZWdvdGlhdGlvbk5lZWRlZCA9IGZhbHNlO1xuXG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIHNlbGYuZGVidWcoXCJJbml0IFN0cmVhbXIgdjEuMC4xMVwiKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIERpZ2l0YXBHYW1lUGxheWVyU0RLLmRlYnVnKFwiU3RyZWFtciBFdmVudCByZWNlaXZlZFwiLCBldmVudC5kYXRhKTtcblxuICAgICAgICBpZiAoIWV2ZW50LmRhdGEgfHwgdHlwZW9mIGV2ZW50LmRhdGEgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZXIsIHR5cGUsIGFjdGlvbiwgb2ZmZXIsIHRvdXJuYW1lbnRfaWQsIHVzZXJuYW1lIH0gPVxuICAgICAgICAgIGV2ZW50LmRhdGE7XG5cbiAgICAgICAgRGlnaXRhcEdhbWVQbGF5ZXJTREsuZGVidWcoXG4gICAgICAgICAgXCJTdHJlYW1yIEV2ZW50IGRldGFpbHM6IFwiLFxuICAgICAgICAgIGNvbnRyb2xsZXIsXG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgb2ZmZXIsXG4gICAgICAgICAgdG91cm5hbWVudF9pZCxcbiAgICAgICAgICB1c2VybmFtZVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChjb250cm9sbGVyICE9PSBcIl9kaWdpdGFwQXBwXCIgfHwgdHlwZSAhPT0gXCJ3ZWJydGNcIikge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIERpZ2l0YXBHYW1lUGxheWVyU0RLLmRlYnVnKFwiU3RyZWFtciDigJM+IFBhc3NlZCB2YWxpZGF0aW9uXCIpO1xuXG4gICAgICAgIGlmICghY29ubmVjdGVkKSB7XG4gICAgICAgICAgY2FudmFzID0gPENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKTtcbiAgICAgICAgICBzdHJlYW0gPSBjYW52YXMuY2FwdHVyZVN0cmVhbSgzMCk7XG4gICAgICAgICAgY29ubmVjdGlvbiA9IG5ldyBSVENQZWVyQ29ubmVjdGlvbih7XG4gICAgICAgICAgICBpY2VTZXJ2ZXJzOiBbeyB1cmxzOiBcInN0dW46c3R1bi5sLmdvb2dsZS5jb206MTkzMDJcIiB9XSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjaGFubmVsID0gY29ubmVjdGlvbi5jcmVhdGVEYXRhQ2hhbm5lbChcbiAgICAgICAgICAgIGBzdHJlYW1yLSR7dG91cm5hbWVudF9pZH0tJHt1c2VybmFtZX1gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBuZWdvdGlhdGVkOiB0cnVlLFxuICAgICAgICAgICAgICBpZDogMCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gXCJjbG9zZVwiKSB7XG4gICAgICAgICAgZm9yIChsZXQgc2VuZGVyIG9mIGNvbm5lY3Rpb24uZ2V0U2VuZGVycygpKSB7XG4gICAgICAgICAgICBjb25uZWN0aW9uLnJlbW92ZVRyYWNrKHNlbmRlcik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY2FudmFzID0gbnVsbDtcbiAgICAgICAgICBzdHJlYW0gPSBudWxsO1xuXG4gICAgICAgICAgY2hhbm5lbC5zZW5kKEpTT04uc3RyaW5naWZ5KHsgdHlwZTogXCJzdHJlYW1yXCIsIGFjdGlvbjogXCJjbG9zZVwiIH0pKTtcbiAgICAgICAgICBjb25uZWN0aW9uLmNsb3NlKCk7XG5cbiAgICAgICAgICBjb25uZWN0aW9uID0gbnVsbDtcbiAgICAgICAgICBjaGFubmVsID0gbnVsbDtcbiAgICAgICAgICBpY2VDYW5kaWRhdGUgPSBudWxsO1xuICAgICAgICAgIGNvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgICAgIGlzTmVnb3RpYXRpb25OZWVkZWQgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWN0aW9uID09PSBcImluaXRcIikge1xuICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2Ygc3RyZWFtLmdldFRyYWNrcygpKSB7XG4gICAgICAgICAgICBjb25uZWN0aW9uLmFkZFRyYWNrKHRyYWNrLCBzdHJlYW0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IG9uQ29ubmVjdGlvblN0YXRlQ2hhbmdlID0gKGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgc2VsZi5kZWJ1ZyhcbiAgICAgICAgICAgICAgXCJTdHJlYW1yIOKAkz4gX19XRUJSVEMub25Db25uZWN0aW9uU3RhdGVDaGFuZ2VfX1wiLFxuICAgICAgICAgICAgICBjb25uZWN0aW9uLmNvbm5lY3Rpb25TdGF0ZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHN3aXRjaCAoY29ubmVjdGlvbi5jb25uZWN0aW9uU3RhdGUpIHtcbiAgICAgICAgICAgICAgY2FzZSBcImNvbm5lY3RlZFwiOlxuICAgICAgICAgICAgICAgIGNvbm5lY3RlZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAoPFdpbmRvdz5ldmVudC5zb3VyY2UpLnBvc3RNZXNzYWdlKFxuICAgICAgICAgICAgICAgICAgeyB0eXBlOiBcInN0cmVhbXJcIiwgYWN0aW9uOiBcImNvbm5lY3RlZFwiIH0sXG4gICAgICAgICAgICAgICAgICBldmVudC5vcmlnaW5cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlIFwiZGlzY29ubmVjdGVkXCI6XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgc2VuZGVyIG9mIGNvbm5lY3Rpb24uZ2V0U2VuZGVycygpKSB7XG4gICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnJlbW92ZVRyYWNrKHNlbmRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhbnZhcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgc3RyZWFtID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICg8V2luZG93PmV2ZW50LnNvdXJjZSkucG9zdE1lc3NhZ2UoXG4gICAgICAgICAgICAgICAgICB7IHR5cGU6IFwic3RyZWFtclwiLCBhY3Rpb246IFwiZGlzY29ubmVjdGVkXCIgfSxcbiAgICAgICAgICAgICAgICAgIGV2ZW50Lm9yaWdpblxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBjaGFubmVsLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICAgICAgIFwiY29ubmVjdGlvbnN0YXRlY2hhbmdlXCIsXG4gICAgICAgICAgICAgICAgICBvbkNvbm5lY3Rpb25TdGF0ZUNoYW5nZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgICAgICAgXCJpY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2VcIixcbiAgICAgICAgICAgICAgICAgIG9uSWNlQ29ubmVjdGlvblN0YXRlQ2hhbmdlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJpY2VjYW5kaWRhdGVcIiwgb25JY2VDYW5kaWRhdGUpO1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICAgICAgIFwib25uZWdvdGlhdGlvbm5lZWRlZFwiLFxuICAgICAgICAgICAgICAgICAgb25OZWdvdGlhdGlvbk5lZWRlZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgICAgICAgXCJvbnNpZ25hbGluZ3N0YXRlY2hhbmdlXCIsXG4gICAgICAgICAgICAgICAgICBvblNpZ25hbGluZ1N0YXRlQ2hhbmdlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBjaGFubmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIG9uTWVzc2FnZSk7XG5cbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uID0gbnVsbDtcbiAgICAgICAgICAgICAgICBjaGFubmVsID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpY2VDYW5kaWRhdGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIGNvbm5lY3RlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGNvbnN0IG9uSWNlQ29ubmVjdGlvblN0YXRlQ2hhbmdlID0gKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICAgIHNlbGYuZGVidWcoXG4gICAgICAgICAgICAgIFwiU3RyZWFtciDigJM+IF9fV0VCUlRDLm9uSUNFQ29ubmVjdGlvblN0YXRlQ2hhbmdlX19cIixcbiAgICAgICAgICAgICAgY29ubmVjdGlvbi5pY2VDb25uZWN0aW9uU3RhdGVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzd2l0Y2ggKGNvbm5lY3Rpb24uaWNlQ29ubmVjdGlvblN0YXRlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJjb25uZWN0ZWRcIjpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSBcImRpc2Nvbm5lY3RlZFwiOlxuICAgICAgICAgICAgICBjYXNlIFwiZmFpbGVkXCI6XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5yZXN0YXJ0SWNlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGNvbnN0IG9uSWNlQ2FuZGlkYXRlID0gKGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgc2VsZi5kZWJ1ZyhcIlN0cmVhbXIg4oCTPiBfX1dFQlJUQy5vbklDRUNhbmRpZGF0ZV9fXCIsIGUuY2FuZGlkYXRlKTtcblxuICAgICAgICAgICAgICBpZiAoZS5jYW5kaWRhdGUpIHtcbiAgICAgICAgICAgICAgICBpY2VDYW5kaWRhdGUgPSBlLmNhbmRpZGF0ZTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxmLmRlYnVnKFxuICAgICAgICAgICAgICAgICAgXCJTdHJlYW1yIOKAkz4gX19XRUJSVEMubG9jYWxEZXNjcmlwdGlvbl9fXCIsXG4gICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLmxvY2FsRGVzY3JpcHRpb25cbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgKDxXaW5kb3c+ZXZlbnQuc291cmNlKS5wb3N0TWVzc2FnZShcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJlYW1yXCIsXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogXCJhbnN3ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgb2ZmZXI6IHdpbmRvdy5idG9hKFxuICAgICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGNvbm5lY3Rpb24ubG9jYWxEZXNjcmlwdGlvbilcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBldmVudC5vcmlnaW5cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlN0cmVhbXIg4oCTPiBfX1dFQlJUQy5vbklDRUNhbmRpZGF0ZV9fXCIsIGVyci5tZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29uc3Qgb25NZXNzYWdlID0gYXN5bmMgKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGlmICghZXZlbnQuZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xuXG4gICAgICAgICAgICAgIGlmIChtZXNzYWdlLmljZUNhbmRpZGF0ZSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uYWRkSWNlQ2FuZGlkYXRlKG1lc3NhZ2UuaWNlQ2FuZGlkYXRlKTtcbiAgICAgICAgICAgICAgICBjaGFubmVsLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBpY2VDYW5kaWRhdGUgfSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlN0cmVhbXIg4oCTPiBfX1dFQlJUQy5vbk1lc3NhZ2VfX1wiLCBlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGNvbnN0IG9uTmVnb3RpYXRpb25OZWVkZWQgPSBhc3luYyAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgaWYgKGlzTmVnb3RpYXRpb25OZWVkZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uLnNldFJlbW90ZURlc2NyaXB0aW9uKEpTT04ucGFyc2Uob2ZmZXIpKTtcbiAgICAgICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5zZXRMb2NhbERlc2NyaXB0aW9uKFxuICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rpb24uY3JlYXRlQW5zd2VyKClcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RyZWFtciDigJM+IF9fV0VCUlRDLm9uTmVnb3RpYXRpb25OZWVkZWRcIiwgZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCBvblNpZ25hbGluZ1N0YXRlQ2hhbmdlID0gKGU6IGFueSkgPT5cbiAgICAgICAgICAgIChpc05lZ290aWF0aW9uTmVlZGVkID0gY29ubmVjdGlvbi5zaWduYWxpbmdTdGF0ZSAhPT0gXCJzdGFibGVcIik7XG5cbiAgICAgICAgICBjb25uZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICAgICBcImNvbm5lY3Rpb25zdGF0ZWNoYW5nZVwiLFxuICAgICAgICAgICAgb25Db25uZWN0aW9uU3RhdGVDaGFuZ2VcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgIFwiaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlXCIsXG4gICAgICAgICAgICBvbkljZUNvbm5lY3Rpb25TdGF0ZUNoYW5nZVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29ubmVjdGlvbi5hZGRFdmVudExpc3RlbmVyKFwiaWNlY2FuZGlkYXRlXCIsIG9uSWNlQ2FuZGlkYXRlKTtcbiAgICAgICAgICBjb25uZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICAgICBcIm9ubmVnb3RpYXRpb25uZWVkZWRcIixcbiAgICAgICAgICAgIG9uTmVnb3RpYXRpb25OZWVkZWRcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgIFwib25zaWduYWxpbmdzdGF0ZWNoYW5nZVwiLFxuICAgICAgICAgICAgb25TaWduYWxpbmdTdGF0ZUNoYW5nZVxuICAgICAgICAgICk7XG4gICAgICAgICAgY2hhbm5lbC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBvbk1lc3NhZ2UpO1xuXG4gICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5zZXRSZW1vdGVEZXNjcmlwdGlvbihKU09OLnBhcnNlKG9mZmVyKSk7XG4gICAgICAgICAgYXdhaXQgY29ubmVjdGlvbi5zZXRMb2NhbERlc2NyaXB0aW9uKGF3YWl0IGNvbm5lY3Rpb24uY3JlYXRlQW5zd2VyKCkpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgc2VsZi5kZWJ1ZyhcIlN0cmVhbXIgLT4gX19XRUJSVENfX1wiLCBlcnIubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRW1wdHkgbWV0aG9kcyBmb3IgZ2FtZSBkZXZlbG9wZXIgdG8gdXNlLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBhZnRlclN0YXJ0R2FtZUZyb21aZXJvKCkge31cblxuICBwdWJsaWMgc3RhdGljIGFmdGVyQ29udGludWVXaXRoQ3VycmVudFNjb3JlKHNjb3JlOiBudW1iZXIsIGxldmVsOiBudW1iZXIpIHt9XG5cbiAgcHVibGljIHN0YXRpYyBhZnRlclN0YXJ0R2FtZSgpIHt9XG5cbiAgcHVibGljIHN0YXRpYyBhZnRlclBhdXNlR2FtZSgpIHt9XG5cbiAgLyoqXG4gICAqIElmIHVzZXIgaXMgZGVidWdnaW5nLCBzaG93IHNvbWUgY29uc29sZSBsb2dzLlxuICAgKlxuICAgKiBAcGFyYW0gbWVzc2FnZSBhbnlcbiAgICogQHBhcmFtIHBhcmFtcyBhbnlbXVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZGVidWcobWVzc2FnZT86IGFueSwgLi4ucGFyYW1zOiBhbnlbXSk6IHZvaWQge1xuICAgIGNvbnN0IHBhcmVudFdpbmRvdzogYW55ID0gd2luZG93O1xuXG4gICAgLy8gaWYgKHBhcmVudFdpbmRvdy5zZGtkZWJ1Zykge1xuICAgICAgY29uc29sZS5sb2coXCJEaWdpdGFwR2FtZVBsYXllclNESyAtPiBcIiArIG1lc3NhZ2UsIC4uLnBhcmFtcyk7XG4gICAgLy8gfVxuICB9XG59XG5cbi8vIFJlYWQgdGhlIGN1cnJlbnQgcXVldWVcbmlmICh0eXBlb2YgKDxhbnk+d2luZG93KS5kaWdpdGFwU0RLICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gIGxldCBvbGRRdWV1ZSA9ICg8YW55PndpbmRvdykuZGlnaXRhcFNESy5xO1xuICBEaWdpdGFwR2FtZVBsYXllclNESy5wcm9jZXNzT2xkUXVldWUob2xkUXVldWUpO1xufVxuXG4vLyBXYXRjaCB0aGUgcXVldWUgd2l0aCBuZXcgbWV0aG9kXG4oPGFueT53aW5kb3cpLmRpZ2l0YXBTREsgPSBEaWdpdGFwR2FtZVBsYXllclNESy5wcm9jZXNzUXVldWU7XG5cbi8vIEZvcmNlIHRoZSBsb2dzIHRvIGJlIGhpZGRlblxuLy8gY29uc3QgbG9nID0gd2luZG93LmNvbnNvbGUubG9nO1xuLy8gd2luZG93LmNvbnNvbGUubG9nID0gZnVuY3Rpb24gKC4uLmFyZ3M6IGFueSkge1xuLy8gICByZXR1cm4gdHJ1ZTtcbi8vIH07XG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZVxuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbl9fd2VicGFja19tb2R1bGVzX19bNjA3XSgpO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==